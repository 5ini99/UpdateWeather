# UpdateWeather 使用指南

## 📖 快速上手

### 第一步：安装依赖

```bash
cd UpdateWeather
pip install -r requirements.txt
```

### 第二步：启动程序

```bash
python3 main.py
```

程序启动后会最小化到系统托盘，你会看到一个「UW」图标。

### 第三步：配置参数

1. **右键点击**托盘图标
2. 选择「**设置**」菜单
3. 在弹出的配置窗口中设置你的参数

---

## ⚙️ 配置说明

### 刷新设置

**刷新间隔（分钟）**
- 设置自动刷新天气的时间间隔
- 范围：1-1440 分钟（1分钟到24小时）
- 建议值：30-120 分钟
- 示例：设置为 60，表示每小时刷新一次

### 夜间模式

**夜间暂停刷新**
- 勾选后，在指定时间段内不执行刷新
- 可以节省系统资源和网络流量

**夜间开始时间**
- 暂停刷新的开始时间
- 范围：0-23（24小时制）
- 示例：23 表示晚上 11 点

**夜间结束时间**
- 恢复刷新的时间
- 范围：0-23（24小时制）
- 示例：7 表示早上 7 点

**示例配置：**
- 开始时间：23
- 结束时间：7
- 效果：晚上 11 点到早上 7 点之间不刷新

### 天气配置

**天气 API Key**
- 你的天气服务 API 密钥
- 需要在天气服务提供商网站注册获取
- 示例：`a1b2c3d4e5f6g7h8i9j0`

**城市 / Location**
- 要查询天气的城市名称
- 支持中英文
- 示例：`Beijing`、`Shanghai`、`New York`

### 邮件通知

**启用邮件通知**
- 勾选后，天气刷新完成时会发送邮件通知
- 需要配置邮件服务器参数（在配置文件中）

---

## 🎯 使用场景

### 场景 1：日常使用

**配置建议：**
- 刷新间隔：60 分钟
- 夜间模式：开启（23:00 - 7:00）
- 开机自启：开启

**说明：**
适合日常使用，每小时更新一次天气，夜间暂停节省资源。

### 场景 2：频繁监控

**配置建议：**
- 刷新间隔：15 分钟
- 夜间模式：关闭
- 邮件通知：开启

**说明：**
适合需要频繁监控天气变化的场景，如户外活动策划。

### 场景 3：省电模式

**配置建议：**
- 刷新间隔：120 分钟
- 夜间模式：开启（22:00 - 8:00）
- 开机自启：关闭

**说明：**
适合笔记本电脑使用，尽量减少资源消耗。

---

## 🔄 常用操作

### 立即刷新

1. 右键点击托盘图标
2. 选择「**立即刷新**」
3. 程序会立即执行一次天气数据刷新

### 修改配置

1. 右键点击托盘图标
2. 选择「**设置**」
3. 修改参数
4. 点击「**保存配置**」
5. 配置立即生效，无需重启

### 开启/关闭自启

1. 右键点击托盘图标
2. 选择「**开机自启**」或「**取消自启**」
3. 状态会立即切换

### 退出程序

1. 右键点击托盘图标
2. 选择「**退出**」
3. 程序完全退出

---

## 💡 使用技巧

### 技巧 1：配置热重载

修改配置后不需要重启程序，配置会在 30 秒内自动生效。你可以在修改配置后：
- 等待 30 秒
- 或点击「立即刷新」强制触发

### 技巧 2：单实例运行

配置窗口只能打开一个，如果已经打开：
- 再次点击「设置」会激活已有窗口
- 不会重复打开多个配置窗口

### 技巧 3：配置文件位置

配置保存在：`~/.update-weather/config.ini`

你可以：
- 手动编辑配置文件（高级用户）
- 备份配置文件到其他电脑使用
- 删除配置文件恢复默认设置

### 技巧 4：查看配置是否生效

修改配置并保存后，可以：
1. 打开配置文件查看是否已更新
   ```bash
   cat ~/.update-weather/config.ini
   ```
2. 等待下次刷新，观察刷新间隔是否符合预期

---

## ❓ 常见问题

### Q1: 配置窗口打不开怎么办？

**A:** 删除锁文件重试：
```bash
rm ~/.update-weather/gui.lock
```

### Q2: 修改配置后不生效？

**A:** 确认以下几点：
1. 是否点击了「保存配置」按钮
2. 配置文件是否已更新（查看 `~/.update-weather/config.ini`）
3. 等待 30 秒让调度器检测到变更

### Q3: 如何恢复默认配置？

**A:** 删除配置文件，程序会自动创建默认配置：
```bash
rm ~/.update-weather/config.ini
```

### Q4: 托盘图标不显示？

**A:** 
- 确认系统支持托盘图标
- 检查系统托盘设置
- 重启程序

### Q5: 如何获取天气 API Key？

**A:** 
1. 访问天气服务提供商网站（如和风天气、OpenWeather 等）
2. 注册账号
3. 在控制台创建 API Key
4. 将 Key 复制到配置中

### Q6: 邮件通知如何配置？

**A:** 
邮件通知需要在配置文件中手动添加邮件服务器参数：
```ini
[mail]
enabled = true
smtp_server = smtp.gmail.com
smtp_port = 587
username = your_email@gmail.com
password = your_password
```

### Q7: 程序占用资源多吗？

**A:** 
非常少！程序大部分时间在休眠等待：
- 内存占用：< 50MB
- CPU 占用：几乎为 0（待机时）
- 网络：仅在刷新时使用

---

## 🚨 注意事项

### 1. API 调用频率限制

大多数天气 API 都有调用频率限制，建议：
- 刷新间隔不要设置太短（建议 >= 30 分钟）
- 查看 API 提供商的限制说明
- 避免因频繁调用导致 API Key 被封禁

### 2. 网络连接

程序需要网络连接才能刷新天气数据：
- 确保网络畅通
- 检查防火墙设置
- 如有代理，需要配置代理设置

### 3. 权限问题

macOS 系统可能需要授予权限：
- 辅助功能权限（用于窗口激活）
- 网络访问权限
- 开机自启权限

### 4. Python 版本

- 建议使用 Python 3.7 或更高版本
- 需要 tkinter 支持（大多数发行版自带）

---

## 📊 配置示例

### 示例 1：标准配置

```ini
[refresh]
interval_minutes = 60

[night]
skip_night = true
night_start = 23
night_end = 7

[weather]
key = your_api_key_here
location = Beijing

[mail]
enabled = false
```

### 示例 2：省电配置

```ini
[refresh]
interval_minutes = 120

[night]
skip_night = true
night_start = 22
night_end = 8

[weather]
key = your_api_key_here
location = Shanghai

[mail]
enabled = false
```

### 示例 3：监控配置

```ini
[refresh]
interval_minutes = 15

[night]
skip_night = false
night_start = 23
night_end = 7

[weather]
key = your_api_key_here
location = Guangzhou

[mail]
enabled = true
```

---

## 🎓 进阶使用

### 手动编辑配置文件

如果你熟悉配置文件格式，可以直接编辑：

```bash
# 打开配置文件
nano ~/.update-weather/config.ini

# 或使用你喜欢的编辑器
vim ~/.update-weather/config.ini
```

### 批量部署

如果需要在多台电脑上使用相同配置：

```bash
# 复制配置文件
cp ~/.update-weather/config.ini ~/config_backup.ini

# 在新电脑上恢复
mkdir -p ~/.update-weather
cp ~/config_backup.ini ~/.update-weather/config.ini
```

### 命令行测试

测试配置界面（无需启动主程序）：

```bash
cd UpdateWeather
python3 app/gui_process.py
```

---

## 📞 获取帮助

如果遇到问题：

1. 查看本使用指南
2. 查看 README.md 文件
3. 检查配置文件是否正确
4. 提交 Issue 到项目仓库

---

**祝使用愉快！** 🌈
